{% extends 'base.html' %}
{% load static %}

{% block title %}
{{project.name}}
{% endblock %}


{% block content %}

<div id="projectsquaremanage1">
    <a href="{% url 'projects:index' %}" style="text-decoration: none;"><img src="{% static 'images/back.png' %}"></a>
    <h1 class="ms-3" style="text-align: center; font-size: 40pt;"> {{project.name}}</h1>
    
    <p>Project Description :</p>
    <table class="tableproject">
            
        <tr background-color: white;>
            <th rowspan="4">
                <div id="projectsquaremanage2">
                    {{project.description}}
                </div>
            </th>
            <th>Timeline :</th>
            <th>Project Size :</th>
        </tr>
        <tr>
            <th><div id="projectsquare3" style="background-color: red;">{{ project.start_date|date:'d M' }} - {{ project.end_date|date:'d M Y' }}</div></th>
            <th><div id="projectsquare3" style="background-color: green;">{{ project.size }}</div></th>
        </tr>
        <tr>
            <th>Project Leader :</th>
            <th>Last Updated :</th>
        </tr>
        <tr>
            <th><div id="projectsquare3" style="background-color: blue;">{{ project.user.username }}</div></th>
            <th><div id="projectsquare3" style="background-color: darkorange;">{{ last_updated }}</div></th>
        </tr>
    </table>
    <br>
    <div class="navbarproject">
        <a id="one" style="text-decoration: underline;" onclick="satu()">
            Project Tasks
        </a>
        <a id="two" onclick="dua()"> 
            Raw Material
        </a>
        <a id="three" onclick="tiga()"> 
            Gantt Chart 
        </a>
        {% if project.user == request.user or request.user.is_superuser == 1 %}
            <button class="button3table" id="newtaskbtn" onclick="addnewtask()" style="display: block;" data-bs-toggle="modal" data-bs-target="#newtask">Add new task</button>
            <button class="button3table" id="newmaterialbtn" onclick="addnewmaterial()" style="display: none;" data-bs-toggle="modal" data-bs-target="#newmaterial">Add new material</button>
            {% comment %} <button class="button3table" id="excelbtn" onclick="converttoexcel()" style="display: none;">Convert to Excel</button> {% endcomment %}
        {% endif %}
    </div>
    <br>
    <div class="accordion" id="projecttasks" style="display: block;">
        <table class="tableprojectsatuan">
            <tr>
                <th style="text-align: center;">Task Name</th>
                <th style="text-align: center;">Timeline</th>
                <th style="text-align: center;">Overall Status</th>
                <th style="text-align: center;">Last Updated at</th>
                <th style="text-align: center;">PIC</th>
                <th style="text-align: center;">Details</th>
                <th style="text-align: center;">Action</th>
            </tr>
            {% for task in tasks %}
                <tr>
                    <td class="text-center">{{ task.name }}</td>
                    <td>
                        <div id="projectsquare3" style="background-color: green; text-align: center;">
                        {{ task.start_date|date:'d M' }} - {{ task.end_date|date:'d M Y' }}
                        </div>
                    </td>
                    <td>
                        <div id="projectsquare3"style="text-align: center;">
                            <div class="progress">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: {{ task.overall_status }}%;" aria-valuenow="{{ task.overall_status }}" aria-valuemin="0" aria-valuemax="100">{{ task.overall_status }}%</div>
                            </div>
                        </div>
                    </td>
                    <td><div id="projectsquare3" style="background-color: red; text-align: center;">{{ task.updated_at|date:'d M Y' }}</div></td>
                    <td><div id="projectsquare3" style="background-color: blue; text-align: center;">{{ task.user.username }}</div></td>
                    <td><a href="#" data-bs-toggle="collapse" data-bs-target="#subtask{{ task.id }}" aria-expanded="false" aria-controls="collapseOne"><img src="{% static 'images/panahbawah.png' %}" style="display: block; margin: 0 auto;"></a></td>
                    <td>
                        <div class="dropdown w-100 text-center">
                            <button class="btn" data-bs-toggle="dropdown" aria-expanded="false">
                                <img src="{% static 'images/vector.png' %}">
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                <li><a class="dropdown-item" id="edit-task" data-id="{{ task.id }}" data-name="{{ task.name }}" data-startdate="{{ task.start_date }}" data-enddate="{{ task.end_date }}" data-pic="{{ task.user_id }}">Update</a></li>
                                <li><a class="dropdown-item" id="delete-task" data-id="{{ task.id }}" data-name="{{ task.name }}">Delete</a></li>
                                <li><a class="dropdown-item" id="reschedule-task" data-id="{{ task.id }}" data-enddate="{{ task.end_date }}">Reschedule</a></li>
                            </ul>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="7" class="p-0">
                        <div class="collapse mb-3" id="subtask{{ task.id }}">
                            <table class="tableprojectsatuansubtask">             
                                <tr>
                                    <td colspan="5" class="text-center">
                                        <div class="d-flex flex-row align-items-center text-center">
                                            <div class="h6 ms-4">Add Subtask</div>
                                            <div class="ms-auto">
                                                <button class="btn btn-primary rounded-pill text-white" id="newsubtaskbtn" data-taskid="{{ task.id }}" data-taskname="{{ task.name }}" data-startdate="{{ task.start_date | date:'Y-m-d'}}" data-enddate="{{ task.end_date | date:'Y-m-d'}}">Add</button>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th style="text-align: center;">Subtask Name</th>
                                    <th style="text-align: center;">Timeline</th>
                                    <th style="text-align: center;">Status</th>
                                    <th style="text-align: center;">Priority</th>
                                    <th style="text-align: center;">Action</th>
                                </tr>
                                {% for subtask in task.subtask_set.all|dictsort:"end_date"|dictsort:"start_date" %}
                                    <tr>
                                        <td class="text-center">{{ subtask.name }}</td>
                                        <td>
                                            <div id="projectsquare3" style="background-color: blue; text-align: center;">
                                            {{ subtask.start_date|date:'d M' }} - {{ subtask.end_date|date:'d M Y' }}
                                            </div>
                                        </td>
                                        <td>
                                            <div id="projectsquare3"style="background-color: {% if subtask.status == 'ns' %}grey{% elif subtask.status == 'ip' %}orange{% elif subtask.status == 'c' %}green{% else %}grey{% endif %};text-align: center;">
                                                {% if subtask.status == "ns" %}
                                                Not Started
                                                {% elif subtask.status == "ip" %}
                                                In Progress
                                                {% elif subtask.status == "c" %}
                                                Completed
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td><div id="projectsquare3" style="background-color: {% if subtask.priority == 'High' %}red{% elif subtask.priority == 'Medium' %}orange{% elif subtask.priority == 'Low' %}green{% endif %}; text-align: center;">{{ subtask.priority }}</div></td>
                                        <td>
                                            <div class="dropdown w-100 text-center">
                                                <button class="btn" data-bs-toggle="dropdown" aria-expanded="false">
                                                    <img src="{% static 'images/vector.png' %}">
                                                </button>
                                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                                    <li><a class="dropdown-item" id="edit-subtask" data-id="{{ subtask.id }}" data-name="{{ subtask.name }}" data-startdate="{{ subtask.start_date }}" data-enddate="{{ subtask.end_date }}" data-status="{{ subtask.status }}" data-priority="{{ subtask.priority }}" data-taskid="{{ subtask.task_id }}">Update</a></li>
                                                    <li><a class="dropdown-item" id="delete-subtask" data-id="{{ subtask.id }}" data-name="{{ subtask.name }}">Delete</a></li>
                                                    <li><a class="dropdown-item" id="reschedule-subtask" data-id="{{ subtask.id }}" data-enddate="{{ subtask.end_date }}">Reschedule</a></li>
                                                </ul>
                                            </div>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    <div id="rawmaterial" style="display: none;">
        <table class="tableprojectsatuan">
            <tr>
                <th style="text-align: center;">Material name</th>
                <th style="text-align: center;">Quantity</th>
                <th style="text-align: center;">Unit</th>
                <th style="text-align: center;">Status</th>
                <th style="text-align: center;">Expected to Arrive</th>
                <th style="text-align: center;">Action</th>
            </tr>
            {% for material in project.rawmaterial_set.all %}
            <tr>
                <td class="text-center">{{ material.name }}</td>
                <td class="text-center">{{ material.quantity }}</td>
                <td class="text-center">{{ material.unit }}</td>
                <td class="text-center">
                    {% if material.status == "0" %}
                    Pending
                    {% elif material.status == "1" %}
                    Arrived
                    {% endif %}
                </td>
                <td class="text-center">{{ material.deadline | date:'d M Y' }}</td>
                <td class="text-center">
                    <div class="dropdown w-100 text-center">
                        <button class="btn" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="{% static 'images/vector.png' %}">
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                            <li><a class="dropdown-item" id="edit-material" data-id="{{ material.id }}" data-name="{{ material.name }}" data-quantity="{{ material.quantity }}" data-unit="{{ material.unit }}" data-status="{{ material.status }}" data-deadline="{{ material.deadline }}" data-projectid="{{ material.project_id }}">Update</a></li>
                            <li><a class="dropdown-item" id="delete-material" data-id="{{ material.id }}" data-name="{{ material.name }}">Delete</a></li>
                        </ul>
                    </div>
                </td>
            </tr>
            {% endfor %}
            </table>
    </div>
    <div id="ganttchart" style="display: none;" class="text-center">
        {% autoescape off %}
            {{ gantt_plot }}
        {% endautoescape %}
    </div>
</div>

    <!-- Modal Task-->
    <div class="modal fade" id="newtask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:store_task' project.slug %}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Add a Task</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <input type="hidden" name="project_id" value="{{project.id}}">
                        <div class="form-group">
                            <label for="name" class="col-form-label">Task Name: </label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Task Name">
                        </div>
                        <div class="mb-3 row">
                            <div class="col-md-6">
                                <label for="start-date" class="col-form-label">Start Date: </label>
                                <input type="date" class="form-control" id="start-date" name="start-date" min="{{ project.start_date |date:'Y-m-d' }}" max="{{ project.end_date | date:'Y-m-d' }}" value="{{ project.start_date |date:'Y-m-d' }}">
                            </div>
                            <div class="col-md-6">
                                <label for="end-date" class="col-form-label">End Date: </label>
                                <input type="date" class="form-control" id="end-date" name="end-date" min="{{ project.start_date |date:'Y-m-d' }}" max="{{ project.end_date | date:'Y-m-d' }}" value="{{ project.end_date | date:'Y-m-d' }}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pic" class="form-label">PIC: </label>
                            <select class="form-control" id="pic" name="pic">
                                {% for member in members %}
                                    <option value="{{ member.user_id }}">{{ member.user.username }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add New Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="updatetask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:update_task' project.slug %}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Update Task</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <input type="hidden" name="project_id" value="{{project.id}}">
                        <input type="hidden" name="task_id" id="task_id">
                        <div class="form-group">
                            <label for="name" class="col-form-label">Task Name: </label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Task Name">
                        </div>
                        <div class="mb-3 row">
                            <div class="col-md-6">
                                <label for="start-date" class="col-form-label">Start Date: </label>
                                <input type="date" class="form-control" id="start-date" name="start-date" min="{{ project.start_date |date:'Y-m-d' }}" max="{{ project.end_date | date:'Y-m-d' }}">
                            </div>
                            <div class="col-md-6">
                                <label for="end-date" class="col-form-label">End Date: </label>
                                <input type="date" class="form-control" id="end-date" name="end-date" min="{{ project.start_date |date:'Y-m-d' }}" max="{{ project.end_date | date:'Y-m-d' }}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pic" class="form-label">PIC: </label>
                            <select class="form-control" id="pic" name="pic">
                                {% for member in members %}
                                    <option value="{{ member.user_id }}">{{ member.user.username }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="rescheduletask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:reschedule_task' project.slug %}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Reschedule Task</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <input type="hidden" name="project_id" value="{{project.id}}">
                        <input type="hidden" name="task_id" id="task_id">
                        <div class="form-group">
                            <label for="end-date" class="col-form-label">Reschedule to: </label>
                            <input type="date" class="form-control" id="end-date" name="end-date">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Reschedule</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deletetask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:delete_task' project.slug %}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Delete Task</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <input type="hidden" name="project_id" value="{{project.id}}">
                        <input type="hidden" name="task_id" id="task_id">
                        <p>Are you sure you want to delete task <span id="task_name"></span>?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Subtask-->
    <div class="modal fade" id="newsubtask" tabindex="-1" role="dialog" aria-labelledby="newsubtaskmodal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:store_subtask' project.slug %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="task_id" name="task_id" />
                    <div class="modal-header">
                        <h5 class="modal-title" id="newsubtaskmodal">Add a Subtask for <span id="task_name"></span></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="name" class="col-form-label">Subtask Name: </label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Subtask Name">
                        </div>
                        <div class="form-group row">
                            <div class="col-6">
                                <label for="start-date" class="col-form-label">Start Date: </label>
                                <input type="date" class="form-control" id="start-date" name="start-date" min="{{ task.start_date | date:'Y-m-d' }}" max="{{ task.end_date | date:'Y-m-d' }}">
                            </div>
                            <div class="col-6">
                                <label for="end-date" class="col-form-label">End Date: </label>
                                <input type="date" class="form-control" id="end-date" name="end-date" min="{{ task.start_date | date:'Y-m-d' }}" max="{{ task.end_date | date:'Y-m-d' }}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="subtask-status" class="col-form-label">Status: </label>
                            <select class="form-control" id="subtask-status" name="status">
                                <option value="ns">Not Started</option>
                                <option value="ip">In Progress</option>
                                <option value="c">Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="subtask-priority" class="col-form-label">Priority: </label>
                            <select class="form-control" id="subtask-priority" name="priority">
                                <option>High</option>
                                <option>Medium</option>
                                <option>Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Edit Subtask-->
    <div class="modal fade" id="updatesubtask" tabindex="-1" role="dialog" aria-labelledby="updatesubtaskmodal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:update_subtask' project.slug %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="subtask_id" name="subtask_id" />
                    <div class="modal-header">
                        <h5 class="modal-title" id="updatesubtaskmodal">Edit Subtask</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="name" class="col-form-label">Subtask Name: </label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Subtask Name">
                        </div>
                        <div class="form-group row">
                            <div class="col-6">
                                <label for="start-date" class="col-form-label">Start Date: </label>
                                <input type="date" class="form-control" id="start-date" name="start-date" min="{{ task.start_date | date:'Y-m-d' }}" max="{{ task.end_date | date:'Y-m-d' }}">
                            </div>
                            <div class="col-6">
                                <label for="end-date" class="col-form-label">End Date: </label>
                                <input type="date" class="form-control" id="end-date" name="end-date" min="{{ task.start_date | date:'Y-m-d' }}" max="{{ task.end_date | date:'Y-m-d' }}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="subtask-status" class="col-form-label">Status: </label>
                            <select class="form-control" id="subtask-status" name="status">
                                <option value="ns">Not Started</option>
                                <option value="ip">In Progress</option>
                                <option value="c">Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="subtask-priority" class="col-form-label">Priority: </label>
                            <select class="form-control" id="subtask-priority" name="priority">
                                <option>High</option>
                                <option>Medium</option>
                                <option>Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="reschedulesubtask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:reschedule_subtask' project.slug %}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Reschedule Subtask</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <input type="hidden" name="project_id" value="{{project.id}}">
                        <input type="hidden" name="subtask_id" id="subtask_id">
                        <div class="form-group">
                            <label for="end-date" class="col-form-label">Reschedule to: </label>
                            <input type="date" class="form-control" id="end-date" name="end-date" min="{{ project.start_date |date:'Y-m-d' }}" max="{{ project.end_date | date:'Y-m-d' }}">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Reschedule</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Delete Subtask-->
    <div class="modal fade" id="deletesubtask" tabindex="-1" role="dialog" aria-labelledby="deletesubtaskmodal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:delete_subtask' project.slug %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="subtask_id" name="subtask_id" />
                    <div class="modal-header">
                        <h5 class="modal-title" id="deletesubtaskmodal">Delete Subtask for <span id="task_name"></span></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this subtask?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Material-->
    <div class="modal fade" id="newmaterial" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:store_material' project.slug %}" method="post">
                    {% csrf_token %}
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Add a Material</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group mb-3">
                            <label for="task-name" class="col-form-label">Material Name: </label>
                            <input type="text" class="form-control" id="task-name" name="name" placeholder="Name">
                        </div>
                        <div class="form-group mb-3">
                            <label for="qty" class="form-label">Quantity: </label>
                            <input type="number" class="form-control" id="qty" min="0" name="quantity" placeholder="Quantity">
                        </div>
                        <div class="form-group mb-3">
                            <label for="unit" class="form-label">Unit: </label>
                            <select class="form-control" id="unit" name="unit">
                                <option value="kg">Kg</option>
                                <option value="liter">Liter</option>
                                <option value="pcs">Pcs</option>
                                <option value="meter">Meter</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="date" class="form-label">Expected arrive: </label>
                            <input type="date" class="form-control" id="date" min="{{ project.start_date | date:'Y-m-d' }}" max="{{ project.end_date | date:'Y-m-d' }}" name="deadline">
                        </div>
                        <div class="form-group mb-3">
                            <label for="status" class="form-label">Status:</label>
                            <select class="form-control" id="status" name="status">
                                <option value="0">Pending</option>
                                <option value="1">Arrived</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Edit Material-->
    <div class="modal fade" id="updatematerial" tabindex="-1" role="dialog" aria-labelledby="updatematerialmodal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:update_material' project.slug %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="material_id" name="material_id" />
                    <div class="modal-header">
                        <h5 class="modal-title" id="updatematerialmodal">Edit Material</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group mb-3">
                            <label for="task-name" class="col-form-label">Material Name: </label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Name">
                        </div>
                        <div class="form-group mb-3">
                            <label for="qty" class="form-label">Quantity: </label>
                            <input type="number" class="form-control" id="quantity" min="0" name="quantity" placeholder="Quantity">
                        </div>
                        <div class="form-group mb-3">
                            <label for="unit" class="form-label">Unit: </label>
                            <select class="form-control" id="unit" name="unit">
                                <option value="kg">Kg</option>
                                <option value="liter">Liter</option>
                                <option value="pcs">Pcs</option>
                                <option value="meter">Meter</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="date" class="form-label">Expected arrive: </label>
                            <input type="date" class="form-control" id="deadline" min="{{ project.start_date | date:'Y-m-d' }}" max="{{ project.end_date | date:'Y-m-d' }}" name="deadline">
                        </div>
                        <div class="form-group mb-3">
                            <label for="status" class="form-label">Status:</label>
                            <select class="form-control" id="status" name="status">
                                <option value="0">Pending</option>
                                <option value="1">Arrived</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Delete Material-->
    <div class="modal fade" id="deletematerial" tabindex="-1" role="dialog" aria-labelledby="deletematerialmodal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="{% url 'projects:delete_material' project.slug %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="material_id" name="material_id" />
                    <div class="modal-header">
                        <h5 class="modal-title" id="deletematerialmodal">Delete Material</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this material?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        var subtaskmodal = new bootstrap.Modal(document.getElementById('newsubtask'));
        var edittaskmodal = new bootstrap.Modal(document.getElementById('updatetask'));
        var reschedulemodal = new bootstrap.Modal(document.getElementById('rescheduletask'));
        var deletetaskmodal = new bootstrap.Modal(document.getElementById('deletetask'));
        var editsubtaskmodal = new bootstrap.Modal(document.getElementById('updatesubtask'));
        var reschedulesubtaskmodal = new bootstrap.Modal(document.getElementById('reschedulesubtask'));
        var deletesubtaskmodal = new bootstrap.Modal(document.getElementById('deletesubtask'));
        var updatematerialmodal = new bootstrap.Modal(document.getElementById('updatematerial'));
        var deletematerialmodal = new bootstrap.Modal(document.getElementById('deletematerial'));

        $(document).on('click', '[id="newsubtaskbtn"]', function() {
            var task_id = $(this).data('taskid');
            var task_name = $(this).data('taskname');
            var start_date = $(this).data('startdate');
            var end_date = $(this).data('enddate');
            $('#newsubtask #task_id').val(task_id);
            $('#newsubtask #task_name').text(task_name);
            $('#newsubtask #start-date').attr('min', start_date);
            $('#newsubtask #end-date').attr('min', start_date);
            $('#newsubtask #start-date').attr('max', end_date);
            $('#newsubtask #end-date').attr('max', end_date);
            subtaskmodal.show();
        });

        $(document).on('click', '[id="edit-subtask"]', function() {
            var subtask_id = $(this).data('id');
            var subtask_name = $(this).data('name');
            var subtask_start_date = new Date($(this).data('startdate'));
            subtask_start_date.setDate(subtask_start_date.getDate() + 1);
            var subtask_end_date = new Date($(this).data('enddate'));
            subtask_end_date.setDate(subtask_end_date.getDate() + 1);
            var subtask_status = $(this).data('status');
            var subtask_priority = $(this).data('priority');
            var task_id = $(this).data('taskid');
            $('#updatesubtask #subtask_id').val(subtask_id);
            $('#updatesubtask #name').val(subtask_name);
            $('#updatesubtask #start-date').val(subtask_start_date.toISOString().substr(0, 10));
            $('#updatesubtask #end-date').val(subtask_end_date.toISOString().substr(0, 10));
            $('#updatesubtask #status').val(subtask_status);
            $('#updatesubtask #priority').val(subtask_priority);
            editsubtaskmodal.show();
        });

        $(document).on('click', '[id="reschedule-subtask"]', function(){
            var subtask_id = $(this).data('id');
            var subtask_end_date = new Date($(this).data('enddate'));
            subtask_end_date.setDate(subtask_end_date.getDate() + 1);
            $('#reschedulesubtask #subtask_id').val(subtask_id);
            $('#reschedulesubtask #end-date').val(subtask_end_date.toISOString().substr(0, 10));
            reschedulesubtaskmodal.show();
        });

        $(document).on('click', '[id="delete-subtask"]', function() {
            var subtask_id = $(this).data('id');
            var subtask_name = $(this).data('name');
            $('#deletesubtask #subtask_id').val(subtask_id);
            $('#deletesubtask #subtask_name').text(subtask_name);
            deletesubtaskmodal.show();
        });

        $(document).on('change', '[id="start-date"]', function(){
            var date = new Date($(this).val());
            date.setDate(date.getDate() + 1);
            $('[id="end-date"]').attr('min', date.toISOString().substr(0, 10));
        });

        $(document).on('click', '[id="edit-task"]', function() {
            var task_id = $(this).data('id');
            var task_name = $(this).data('name');
            var start_date = new Date($(this).data('startdate'));
            start_date.setDate(start_date.getDate() + 1);
            var end_date = new Date($(this).data('enddate'));
            end_date.setDate(end_date.getDate() + 1);
            var pic = $(this).data('pic');
            $('#updatetask #task_id').val(task_id);
            $('#updatetask #name').val(task_name);
            $('#updatetask #start-date').val(start_date.toISOString().substr(0, 10));
            $('#updatetask #end-date').val(end_date.toISOString().substr(0, 10));
            $('#updatetask #pic').val(pic);
            edittaskmodal.show();
        });

        $(document).on('click', '[id="reschedule-task"]', function(){
            var task_id = $(this).data('id');
            var end_date = new Date($(this).data('enddate'));
            end_date.setDate(end_date.getDate() + 1);
            $('#rescheduletask #task_id').val(task_id);
            $('#rescheduletask #end-date').val(end_date.toISOString().substr(0, 10));
            reschedulemodal.show();
        });

        $(document).on('click', '[id="delete-task"]', function(){
            var task_id = $(this).data('id');
            var task_name = $(this).data('name');
            $('#deletetask #task_id').val(task_id);
            $('#deletetask #task_name').text(task_name);
            deletetaskmodal.show();
        });

        $(document).on('click', '[id="delete-material"]', function(){
            var material_id = $(this).data('id');
            var material_name = $(this).data('name');
            $('#deletematerial #material_id').val(material_id);
            $('#deletematerial #material_name').text(material_name);
            deletematerialmodal.show();
        });

        $(document).on('click', '[id="edit-material"]', function(){
            var material_id = $(this).data('id');
            var material_name = $(this).data('name');
            var material_quantity = $(this).data('quantity');
            var material_unit = $(this).data('unit');
            var material_status = $(this).data('status');
            var material_deadline = new Date($(this).data('deadline'));
            material_deadline.setDate(material_deadline.getDate() + 1);
            $('#updatematerial #material_id').val(material_id);
            $('#updatematerial #name').val(material_name);
            $('#updatematerial #quantity').val(material_quantity);
            $('#updatematerial #unit').val(material_unit);
            $('#updatematerial #status').val(material_status);
            $('#updatematerial #deadline').val(material_deadline.toISOString().substr(0, 10));
            updatematerialmodal.show();
        });
    </script>

{% endblock %}

